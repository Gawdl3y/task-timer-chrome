(function(t){var c={series:{pie:{show:!1,radius:"auto",innerRadius:0,startAngle:1.5,tilt:1,offset:{top:0,left:"auto"},stroke:{color:"#FFF",width:1},label:{show:"auto",formatter:function(c,t){return'<div style="font-size:x-small;text-align:center;padding:2px;color:'+t.color+';">'+c+"<br/>"+Math.round(t.percent)+"%</div>"},radius:1,background:{color:null,opacity:0},threshold:0},combine:{threshold:-1,color:null,label:"Other"},highlight:{opacity:0.5}}}};t.plot.plugins.push({init:function(s){function H(a){C||
(C=!0,l=a.getCanvas(),v=t(l).parent(),c=a.getOptions(),a.setData(I(a.getData())))}function I(a){for(var b=0;b<a.length;++b)if("number"==typeof a[b].data)a[b].data=[[1,a[b].data]];else if("undefined"==typeof a[b].data||"undefined"==typeof a[b].data[0])"undefined"!=typeof a[b].data&&"undefined"!=typeof a[b].data.label&&(a[b].label=a[b].data.label),a[b].data=[[1,0]];for(var b=a,g=0;g<b.length;++g){var h=parseFloat(b[g].data[0][1]);h&&(n+=h)}for(var g=b=0,h=c.series.pie.combine.color,e=[],d=0;d<a.length;++d)a[d].data[0][1]=
parseFloat(a[d].data[0][1]),a[d].data[0][1]||(a[d].data[0][1]=0),a[d].data[0][1]/n<=c.series.pie.combine.threshold?(b+=a[d].data[0][1],g++,h||(h=a[d].color)):e.push({data:[[1,a[d].data[0][1]]],color:a[d].color,label:a[d].label,angle:a[d].data[0][1]*2*Math.PI/n,percent:100*(a[d].data[0][1]/n)});0<g&&e.push({data:[[1,b]],color:h,label:c.series.pie.combine.label,angle:b*2*Math.PI/n,percent:100*(b/n)});return e}function J(a,b){function g(){ctx.clearRect(0,0,l.width,l.height);v.children().filter(".pieLabel, .pieLabelBackground").remove()}
function h(){function a(d,c,e){0>=d||(e?ctx.fillStyle=c:(ctx.strokeStyle=c,ctx.lineJoin="round"),ctx.beginPath(),1E-9<Math.abs(d-2*Math.PI)?ctx.moveTo(0,0):false&&(d-=1E-4),ctx.arc(0,0,b,g,g+d,!1),ctx.closePath(),g+=d,e?ctx.fill():ctx.stroke())}startAngle=Math.PI*c.series.pie.startAngle;var b=1<c.series.pie.radius?c.series.pie.radius:p*c.series.pie.radius;ctx.save();ctx.translate(m,z);ctx.scale(1,c.series.pie.tilt);ctx.save();for(var g=startAngle,d=0;d<e.length;++d)e[d].startAngle=g,a(e[d].angle,
e[d].color,!0);ctx.restore();ctx.save();ctx.lineWidth=c.series.pie.stroke.width;g=startAngle;for(d=0;d<e.length;++d)a(e[d].angle,c.series.pie.stroke.color,!1);ctx.restore();D(ctx);if(c.series.pie.label.show)for(var d=startAngle,f=1<c.series.pie.label.radius?c.series.pie.label.radius:p*c.series.pie.label.radius,h=0;h<e.length;++h){if(e[h].percent>=100*c.series.pie.label.threshold){var j=e[h],k=d,r=h;if(0!=j.data[0][1]){var q=c.legend.labelFormatter,u=void 0,s=c.series.pie.label.formatter,u=q?q(j.label,
j):j.label;s&&(u=s(u,j));q=(k+j.angle+k)/2;k=m+Math.round(Math.cos(q)*f);q=z+Math.round(Math.sin(q)*f)*c.series.pie.tilt;v.append('<span class="pieLabel" id="pieLabel'+r+'" style="position:absolute;top:'+q+"px;left:"+k+'px;">'+u+"</span>");r=v.children("#pieLabel"+r);u=q-r.height()/2;q=k-r.width()/2;r.css("top",u);r.css("left",q);if(0<0-u||0<0-q||0>l.height-(u+r.height())||0>l.width-(q+r.width()))A=!0;0!=c.series.pie.label.background.opacity&&(k=c.series.pie.label.background.color,null==k&&(k=j.color),
j="top:"+u+"px;left:"+q+"px;",t('<div class="pieLabelBackground" style="position:absolute;width:'+r.width()+"px;height:"+r.height()+"px;"+j+"background-color:"+k+';"> </div>').insertBefore(r).css("opacity",c.series.pie.label.background.opacity))}}d+=e[h].angle}ctx.restore()}if(v){ctx=b;B=v.children().filter(".legend").children().width();p=Math.min(l.width,l.height/c.series.pie.tilt)/2;z=l.height/2+c.series.pie.offset.top;m=l.width/2;m="auto"==c.series.pie.offset.left?c.legend.position.match("w")?
m+B/2:m-B/2:m+c.series.pie.offset.left;m<p?m=p:m>l.width-p&&(m=l.width-p);for(var e=a.getData(),d=0;A&&d<E;){A=!1;0<d&&(p*=K);d+=1;g();if(0.8>=c.series.pie.tilt){var j=1<c.series.pie.radius?c.series.pie.radius:p*c.series.pie.radius;if(!(j>=l.width/2-5||j*c.series.pie.tilt>=l.height/2-15||10>=j)){ctx.save();ctx.translate(5,15);ctx.globalAlpha=0.02;ctx.fillStyle="#000";ctx.translate(m,z);ctx.scale(1,c.series.pie.tilt);for(var f=1;10>=f;f++)ctx.beginPath(),ctx.arc(0,0,j,0,2*Math.PI,!1),ctx.fill(),j-=
f;ctx.restore()}}h()}d>=E&&(g(),v.prepend('<div class="error">Could not draw pie with labels contained inside canvas</div>'));a.setSeries&&a.insertLegend&&(a.setSeries(e),a.insertLegend())}}function D(a){0<c.series.pie.innerRadius&&(a.save(),innerRadius=1<c.series.pie.innerRadius?c.series.pie.innerRadius:p*c.series.pie.innerRadius,a.globalCompositeOperation="destination-out",a.beginPath(),a.fillStyle=c.series.pie.stroke.color,a.arc(0,0,innerRadius,0,2*Math.PI,!1),a.fill(),a.closePath(),a.restore(),
a.save(),a.beginPath(),a.strokeStyle=c.series.pie.stroke.color,a.arc(0,0,innerRadius,0,2*Math.PI,!1),a.stroke(),a.closePath(),a.restore())}function L(a){F("plothover",a)}function M(a){F("plotclick",a)}function F(a,b){var g=s.offset(),h=parseInt(b.pageX-g.left);a:{for(var g=parseInt(b.pageY-g.top),e=s.getData(),d=s.getOptions(),d=1<d.series.pie.radius?d.series.pie.radius:p*d.series.pie.radius,j=0;j<e.length;++j){var f=e[j];if(f.pie.show){ctx.save();ctx.beginPath();ctx.moveTo(0,0);ctx.arc(0,0,d,f.startAngle,
f.startAngle+f.angle,!1);ctx.closePath();x=h-m;y=g-z;if(ctx.isPointInPath){if(ctx.isPointInPath(h-m,g-z)){ctx.restore();h={datapoint:[f.percent,f.data],dataIndex:0,series:f,seriesIndex:j};break a}}else{p1X=d*Math.cos(f.startAngle);p1Y=d*Math.sin(f.startAngle);p2X=d*Math.cos(f.startAngle+f.angle/4);p2Y=d*Math.sin(f.startAngle+f.angle/4);p3X=d*Math.cos(f.startAngle+f.angle/2);p3Y=d*Math.sin(f.startAngle+f.angle/2);p4X=d*Math.cos(f.startAngle+f.angle/1.5);p4Y=d*Math.sin(f.startAngle+f.angle/1.5);p5X=
d*Math.cos(f.startAngle+f.angle);p5Y=d*Math.sin(f.startAngle+f.angle);arrPoly=[[0,0],[p1X,p1Y],[p2X,p2Y],[p3X,p3Y],[p4X,p4Y],[p5X,p5Y]];arrPoint=[x,y];for(var l=!1,w=-1,t=arrPoly.length,n=t-1;++w<t;n=w)(arrPoly[w][1]<=arrPoint[1]&&arrPoint[1]<arrPoly[n][1]||arrPoly[n][1]<=arrPoint[1]&&arrPoint[1]<arrPoly[w][1])&&arrPoint[0]<(arrPoly[n][0]-arrPoly[w][0])*(arrPoint[1]-arrPoly[w][1])/(arrPoly[n][1]-arrPoly[w][1])+arrPoly[w][0]&&(l=!l);if(l){ctx.restore();h={datapoint:[f.percent,f.data],dataIndex:0,series:f,
seriesIndex:j};break a}}ctx.restore()}}h=null}if(c.grid.autoHighlight)for(g=0;g<k.length;++g)e=k[g],e.auto==a&&!(h&&e.series==h.series)&&(e=e.series,null==e&&(k=[],s.triggerRedrawOverlay()),"number"==typeof e&&(e=series[e]),e=G(e),-1!=e&&(k.splice(e,1),s.triggerRedrawOverlay()));h&&(g=h.series,"number"==typeof g&&(g=series[g]),e=G(g),-1==e?(k.push({series:g,auto:a}),s.triggerRedrawOverlay()):a||(k[e].auto=!1));v.trigger(a,[{pageX:b.pageX,pageY:b.pageY},h])}function G(a){for(var b=0;b<k.length;++b)if(k[b].series==
a)return b;return-1}function N(a,b){var c=a.getOptions(),h=1<c.series.pie.radius?c.series.pie.radius:p*c.series.pie.radius;b.save();b.translate(m,z);b.scale(1,c.series.pie.tilt);for(i=0;i<k.length;++i){var e=k[i].series;0>e.angle||(b.fillStyle="rgba(255, 255, 255, "+c.series.pie.highlight.opacity+")",b.beginPath(),1E-9<Math.abs(e.angle-2*Math.PI)&&b.moveTo(0,0),b.arc(0,0,h,e.startAngle,e.startAngle+e.angle,!1),b.closePath(),b.fill())}D(b);b.restore()}var l=null,v=null,p=null,m=null,z=null,n=0,A=!0,
E=10,K=0.95,B=0,C=!1,k=[];s.hooks.processOptions.push(function(a,b){b.series.pie.show&&(b.grid.show=!1,"auto"==b.series.pie.label.show&&(b.series.pie.label.show=b.legend.show?!1:!0),"auto"==b.series.pie.radius&&(b.series.pie.radius=b.series.pie.label.show?0.75:1),1<b.series.pie.tilt&&(b.series.pie.tilt=1),0>b.series.pie.tilt&&(b.series.pie.tilt=0),a.hooks.processDatapoints.push(H),a.hooks.drawOverlay.push(N),a.hooks.draw.push(J))});s.hooks.bindEvents.push(function(a,b){var c=a.getOptions();c.series.pie.show&&
c.grid.hoverable&&b.unbind("mousemove").mousemove(L);c.series.pie.show&&c.grid.clickable&&b.unbind("click").click(M)})},options:c,name:"pie",version:"1.0"})})(jQuery);